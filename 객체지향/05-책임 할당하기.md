# 책임 할당하기

## 배경
책임 할당 과정은 일종의 트레이드오프 활동이다.
올바른 책임 할당을 위해 다양한 관점에서 설계를 평가할 수 있어야한다. 이 때 `GRASP 패턴`을 이용하여 다양한 기준에 따라 책임을 할당하고 결과를 트레이드 오프할 수 있는 기준을 세울수 있다.

- 트레이드오프라는 것이 정확히 어떤 의미로 사용한것인가? => 책임을 결정할 때 여러 가능성중에서 하나를 선택하는데 이것을 선택에 따른 트레이드오프 라는 의미로 사용한 것이다.
- GRASP 패턴이 뭐지? => 객체에게 책임을 할당할때 기준으로 갖는 원칙들

## 책임 주도 설계를 향해

### 객체의 행동(책임)을 먼저 결정
객체에게 중요한 것은 외부에 제공하는 행동이다. 
행동이라는 것은 클라이언트 관점에서 볼 때 해당 객체가 수행해줄 수 있는 행동이라는 것이고, 이말은 객체가 갖고 있는 책임이라는 것이다.
따라서 설계에 있어 각 객체의 책임을 먼저 결정하는 과정이 필요한데 어떤 책임을 할당해야 좋은지 판단 기준은 객체간의 `협력`을 기준으로 판단하도록 한다.

### 협력이라는 문맥안에서 책임을 결정
책임은 객체 입장이 아니라 객체가 참여하는 협력에 적합해야된다. 객체 단일로 보았을때 그 책임이 어색하더라도 협력에 어울려야 된다.
협력의 시작은 메시지를 전송자로 부터 시작이다. 클라이언트의 의도에 적합한 책임을 할당해야된다.
> 메시지를 먼저 결정한 후 메시지를 처리할 객체를 결정하도록한다. 메시지가 있기때문에 그 메시지를 처리할 객체가 필요하기 때문이다.
> 메시지를 보내는 객체는 호출한쪽의 의도에 맞는 메시지를 보낼 책임을 갖고, 어떤 객체가 수신할지는 알지 못한다.
> 메시지를 받는 객체는 메시지를 처리할 책임을 갖는다.

### 책임 주도 설계
1. 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악
2. 시스템 책임을 더 작은 책임으로 분할
3. 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당
4. 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
5. 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.

> 책임을 결정한 후에 책임을 수행할 객체를 결정
> 객체 내부 상태는 객체들간의 책임이 어느정도 정리된 후에 결정하도록한다.

## GRASP 패턴
GRASP은 General Responsibity Assignment Software Pattern의 약자로 `객체에게 책임을 할당할 때` 지침을 삼을수 있는 원칙의 집합을 패턴 형식으로 정리한 것이다.
시작은 도메인 개념으로 부터 시작하여 각 도메인의 책임을 수행할 객체의 책임을 판단할때 GRASP의 패턴을 참고하여 결정하도록한다.
이 때 도메인 개념을 정리하는데 너무 많은 시간을 들이지 말고 빠르게 설계와 구현을 진행하는 것이 좋다.
왜냐하면 협력과 책임이 정확하게 동작하는지는 코드를 작성하고 실행해봤을때 확인 가능하기 때문이다.

### GRASP에서 사용하는 패턴들 요약
- information expert: 책임을 수행하는 데 필요한 정보를 가지고 있는 객체에게 할당
- low coupling: 객체간의 결합도가 낮은 방향으로 책임을 할당
- high cohesion: 높은 응집도를 유지할 수 있는 방향으로 책임을 할당
- creator: 객체의 생성 책임을 생성되는 객체와 연결되거나, 관련될 필요가 있는 객체에게 맡기는 것
- polymorphism: 객체의 타입에 따라 변하는 로직일 있을때 if, switch, 등 논리 연사자를 이용하기 보다는 타입을 명시적으로 정의하고 각 타입에 다형적으로 행동하는 책임을 할당하라
- portected variations: 변경이 예상되는 지점은 인터페이스를 통해 책임을 할당하도록한다.

### INFORMATION EXPERT
어플리케이션의 책임을 수행하기 위해 어떤 객체에게 메시지를 전송할 것인가로 부터 시작한다.
즉 메시지를 전송할 객체는 무엇을 원하는가?
그리고 해당 메시지를 수신할 적합한 객체는 무엇인가?
적합한 객체는 메시지를 수신하고 적합한 책임을 수행한다.
이 때 이 객체는 캡슐화 원칙에 따라 책임 수행에 필요한 정보는 해당 객체안에 존재한다.

> 객체가 자신이 소유하고 있는 정보와 관련된 작업을 수행한다라는 일반적인 직관을 표현한것
> 객체 스스로 처리할 수 없는 작업이 있다면 다른 객체에게 메시지를 전달해야된다. 메시지를 전송하는 행위자체가 새로운 객체의 책임으로 할당되기 때문에 협력의 공동체를 구성할 수 있다.

### LOW COUPLING & HIGH COHESION
책임을 할당할 수 있는 다양한 대안이 있을 경우 최대한 낮은 결합도와 응집도가 높은 방향을 유지할 수 있는 대안으로 선택한다.

### CREATOR
협력의 최종 결과물은 책임을 수행할 수 있는 인스턴스를 생성하는 것이다.
이 때 인스턴스를 생성하는 책임은 아래 4가지 조건을 최대한 만족하는 객체에 맡긴다.

1. 생성할 객체를 포함하거나 참조한다.
2. 생성할 객체를 기록한다.
3. 생성할 객체를 긴밀하게 사용한다.
4. 생성할 객체의 생성에 필요한 데이터를 갖고 있다.

### polymorphism
비율할인과 금액할인 처럼 동일한 다른 객체이지만 동일한 책임을 수행한다면 두 객체는 같은 역할을 갖고 있다라고 볼 수 있다.
협력 관점에서 같은 역할을 갖고 있는 객체들은 대체 가능성을 의믜하므로 클라이언트 입장에서는 구체적인 책임을 수행하는 객체를 알지 못한 채 역할에 대해서만 결합되도록 해야된다.
그러기 위해서는 타입을 추상화하여 연결하는데 이때 인터페이스나 추상클래스를 이용한다.

### protected variations
책임 할당의 관점에서 캡슐화를 설명하는 것으로 클래스를 변경에 따라 분리하고 인터페이스를 이용해 변경을 캡슐화하면 결합도와 응집도를 향상시키는 매우 강력한 방법이 된다.
이 말은 클라이언트에서 변경이 예상되는 부분은 인터페이스를 통해 언제든지 구현체만 바꿔가며 사용할 수 있는 상태로 만들라는 것이다.

> 책임주도 설계의 시작은 어플리케이션의 도메인으로 부터 시작한다.( 큰 단위의 추상화된 책임을 갖는 객체를 만드는 작업 )
> 좋은 도메인은 구현을 가이드할 수 있는 도메인이다. ( 변경에 관한 사항도 도메인에 추상화된 상태로 표현되어 있어야 된다. )
> GRASP 패턴은 객체의 책임 판단의 지표로 참고한다.

## 리펙토링도 책임 주도 설계의 방법
책임주도 설계를 처음부터 적용하기란 쉽지 않다. 대신 일단 동작하는 코드를 빠르게 만들고 객체의 책임을 올바르게 배치하도록하는 작업을하는것도 좋은 방법 중 하나이다. 이것을 리펙토링이라고 한다.
단 코드를 수정한 후 겉으로 들어나는 동작은 바뀌어서는 안된다. 동작은 그래돌 유지한체 이해하기 쉽고 변경에 유연한 코드를 만들어내야한다.

> 동작하는 코드를 먼저 구현한 다음 캡슐화, 결합도, 응집도를 이해한 상태에서 객체지향 원칙을 적용해 나가는 리펙토링 과정을 거치는 것도 깔끔한 코드를 얻을 수 있는 방법이다.
> 결과적으로 내부 구현은 캡슐화, 모든 클래스는 변경의 이유가 1개씩만 갖는 상태, 각 객체는 높은 응집도와 낮은 결합도를 갖음, 클래스는 작고 1가지 일만 수행, 책임은 적절하게 분배 되어야함