# 메시지와 인터페이스

## 배경
유연하고 재사용 가능한 퍼블릭 인터페이스를 만들기 위해 도움이 되는 설계 원칙과 기법을 알고 있어야한다.
왜? 좋은 객체지향 코드를 위해서는 객체가 수행하는 책임에 초점을 맞춰야하고 이것은 객체가 수신할 메시지에 기반한다. 메시지는 객체 수신하는 메시지는 객체들의 퍼블릭 메소드이기 때문에 올바른 객체지향 코드를 만들기 위해서는 퍼블릭 인터페이스를 잘 구현해야된다.

## 협력과 메시지
협력은 클라이언트가 서버의 서비스를 요청하는 반방향 상호작용을 말한다.
협력 관점에서 객체는 두 가지 종류의 메시지 집합이다.
1. 객체가 수신하는 메시지의 집합
2. 외부의 객체에게 전송하는 메시지의 집합

협력에 적합한 객체를 만들기 위해서는 위 두가지를 모두 생각하여 객체를 만들어야한다.

> 객체가 독립적으로 수행할 수 있는 것보다 더 큰 책임을 수행하기 위해 다른 객체와 협력해야된다. 여기서 협력을 가능케하 매개체가 `메시지`이다.

### 용어 정리
- 메시지: 오퍼레이션명 + 인자로 구성되며, 객체와 협력하기 위한 매개체.
- 오퍼레이션: 수행가능한 행동에 대한 추상화, 메시지를 수신한 객체에 대해서만 관점을 갖고 있음
- 메서드: 오퍼레이션의 구현으로 실행시점에서 수행되는 행위, 다형성에 의해 오퍼레이션과 다른 메서드가 실행될 수 있음
- 퍼블릭 인터페이스: 객체가 외부에서 수신가능한 메시지의 집합
- 시그니처: 오퍼레이션의 이름과 인자 목록을 포함하여 일컷는말

> 객체가 수신할 수 있는 메시지가 객체의 퍼블릭 인터페이스와 그 안에 포함될 오퍼레이션을 결정한다. 객체의 퍼블릭 인터페이스가 객체의 품질을 결정하기 때문에 결국 메시지가 객체의 품질을 결정한다.

## 인터페이스와 설계 품질
좋은 인터페이스는 최소한의 인터페이스와 추상적인 인터페이스라는 조건을 만족해야된다. 추상적인 인터페이스는 무엇을 하는지 명확하게 표현해야된다.

퍼블릭 인터페이스의 품질에 영향을 미지는 원칙과 기법들
- 디미터 법칙: 객체 내부의 구조에 강하게 결합되지 않도록 협력의 경로를 제한 (최대한 적은 수의 퍼블릭 인터페이스를 만들어라)
- 묻지말고 시켜라: 메시지를 받는 객체의 상태를 검사하지말고, 메시지를 전달하기만 한다.
- 의도를 드러내는 인터페이스: 어떻게 수행하는지가 아닌 무엇을 하느냐에 초점을 맞춰 작성
- 명령-쿼리 분리: 명령은 객체의 상태를 변경&반환값이 없음, 쿼리는 상태변경없음&반환값있음, 명령과 쿼리를 분리함으로써 얻는 이익은 쿼리를 요청하였을때 매번 같은 결과값을 얻을 수 있어 결과에 대한 예측을 쉽게 할 수 있도록 도와준다. 쿼리처럼 보이지만 명령을 갖는 메소드는 예측하기 어렵고 버그를 발생시킬 가능성이 크다( 조회 할때마다 객체 내부 상태를 변경시켜 값이 달리지는 경우 )

각 기법들의 종합적인 내용은 캡슐화를 지킬수 있고, 클라이언트의 메시지의 의도를 메소드 내부 구현을 보지 않고 알 수 있는 이름으로 지어야한다.
여기서 캡슐화를 지킬수 있다라는 의미는 객체 내부 구현을 노출시키는것인가에 대함이다.

> 각 원칙은 무조건적으로 맹신해서는 안되며, 상황에 따라 적용을 고려하여야한다. 설계는 트레이트오프의 산물이라는 점을 기억

## 원칙의 함정
디미터법칙에서 오해할만한 것이 하나의 최소한의 퍼블릭 인터페이스를 사용하라고 해서 여러개의 퍼블릭 인터페이스가 절대적으로 나쁘다는것이 아니다.
디머터법칙은 결합도와 관련된것으로 객체 내부 구조를 노출하지 않는다면 그것은 디미터법칙을 준수한것이다.
묻지말고 시켜라에서는 객체의 상태를 체크하지말고 메시지를 전달해야된다고 하였지만, 그렇게되면 메시지를 처리하는 개체에 필요없는 책임이 추가될 가능성이 있어 전체적으로 응집도가 낮아질 수 있다.
경우에따라 물어봐야하는 상황이 생길수 있기 때문에 적절한 트레이트오프를 통해 판단해야된다.

## 참조 투명성
참조 투명성 특성을 지키면 적은 버그와 쉬운 디버깅, 쿼리 순서에 상관없이 동일한 결과를 얻는 코드를 작성할 수 있다.
참조 투명성이란 어떠한 표현식(함수)를 그 표현식(함수)가 나타내는값으로 치환하더라도 결과가 달라지지 않는것을 말하여 좀 더 자세히 이해하기 위해서는
불변성, 부수효과, 참조투명성 사이의 관계를 알아야한다.
여기서 불변성(immutability)은 객체의 상태가 절대 변하지 않는 상태를 말하며, 부수효과(side effect)는 명령으로 인해 상태가 변경됨을 말한다.

> 만약 참조 투명성을 지키는 객체가 있다고 하면 해당 객체는 불변성의 특성을 갖고 있으며 부수효과가 없는 객체라고 말할 수 있다.
> 모든 함수를 이미 알고 있는 하나의 결과값으로 치환할 수 있기 때문에 예측하기 쉽고, 순서를 변경 하더라도 결과는 달라지지 않는다.

## 책임에 초점을 맞춰라
인터페이스 설계를 위한 원칙을 쉽게 지키기 위한 방법으로 책임에 초점을 맞춰 설계를 진행하기이다.
- 메시지를 먼저 선택하고 그 후에 메시지를 처리할 객체를 선택
- 객체의 구현 이전에 객체 사이의 협력에 초점을 맞추고 협력 방식을 단순하고 유연하게 만든다.

> 책임 주도 설계에서는 메시지가 객체를 선택하기 때문에 협력에 적합한 메시지를 결정할 수 있는 확률이 높아진다.
> 이 장에서 설명한 내용들은 인터페이스를 만들수 있는 지침을 제공하지만 `실행시점`에서의 제약을 인터페이스에 명시할수는 없다. 이를 위해 `계약에 의한 설계`를 적용하면 좋다.